# Open WebUI 외부 접속 설정 가이드

## 목차
1. [개요](#개요)
2. [로컬 네트워크 접속](#로컬-네트워크-접속)
3. [인터넷을 통한 외부 접속](#인터넷을-통한-외부-접속)
4. [보안 설정](#보안-설정)
5. [역방향 프록시 설정](#역방향-프록시-설정)
6. [HTTPS 설정](#https-설정)
7. [클라우드 배포](#클라우드-배포)
8. [문제 해결](#문제-해결)

## 개요

Open WebUI를 외부에서 접속할 수 있도록 설정하는 방법을 안내합니다. 보안을 고려하여 단계별로 설정하는 것을 권장합니다.

### 현재 설정 확인

기본적으로 Open WebUI는 `0.0.0.0:8080`에서 실행됩니다:
- `0.0.0.0`: 모든 네트워크 인터페이스에서 접속 허용
- `8080`: 기본 포트

## 로컬 네트워크 접속

### 1. 서버 설정 확인

서버가 모든 인터페이스에서 수신하도록 설정되어 있는지 확인:

```powershell
# 현재 실행 중인 서버 확인
netstat -ano | findstr :8080
```

### 2. 방화벽 설정

#### Windows 방화벽

1. **Windows Defender 방화벽 설정**
   ```powershell
   # 관리자 권한으로 실행
   New-NetFirewallRule -DisplayName "Open WebUI" -Direction Inbound -LocalPort 8080 -Protocol TCP -Action Allow
   ```

2. **GUI를 통한 설정**
   - 제어판 → 시스템 및 보안 → Windows Defender 방화벽
   - "고급 설정" 클릭
   - "인바운드 규칙" → "새 규칙"
   - 포트 선택 → TCP → 특정 로컬 포트: 8080
   - 연결 허용 → 모든 프로필 선택 → 이름: "Open WebUI"

#### Linux 방화벽 (UFW)

```bash
sudo ufw allow 8080/tcp
sudo ufw reload
sudo ufw status
```

#### Linux 방화벽 (firewalld)

```bash
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### 3. 로컬 네트워크에서 접속

같은 네트워크의 다른 기기에서 접속:
```
http://서버IP주소:8080
```

서버 IP 주소 확인:
```powershell
# Windows
ipconfig

# Linux/Mac
ifconfig
# 또는
ip addr show
```

## 인터넷을 통한 외부 접속

### 방법 1: 포트 포워딩 (가정용 라우터)

#### 1. 공인 IP 확인

```powershell
# 외부에서 확인
Invoke-RestMethod -Uri "https://api.ipify.org?format=json"
```

또는 브라우저에서: https://www.whatismyip.com/

#### 2. 라우터 설정

1. 라우터 관리 페이지 접속 (보통 `192.168.1.1` 또는 `192.168.0.1`)
2. 포트 포워딩 설정 메뉴 찾기
3. 다음 정보 입력:
   - **서비스 이름**: Open WebUI
   - **외부 포트**: 8080 (또는 원하는 포트)
   - **내부 IP**: 서버의 로컬 IP 주소
   - **내부 포트**: 8080
   - **프로토콜**: TCP
4. 저장 및 적용

#### 3. 접속

외부에서 접속:
```
http://공인IP주소:8080
```

**주의**: 이 방법은 보안상 권장되지 않습니다. HTTPS와 인증을 반드시 설정하세요.

### 방법 2: 역방향 프록시 (권장)

역방향 프록시를 사용하면 보안과 성능을 향상시킬 수 있습니다.

## 보안 설정

### 1. 기본 인증 설정

Open WebUI는 기본적으로 사용자 인증을 지원합니다. 관리자 계정을 생성하고 사용자 관리를 활성화하세요.

### 2. 환경 변수 설정

```powershell
# 인증 활성화
$env:WEBUI_AUTH = "true"

# 회원가입 비활성화 (선택사항)
$env:ENABLE_SIGNUP = "false"

# CORS 설정 (프로덕션에서는 특정 도메인만 허용)
$env:CORS_ALLOW_ORIGINS = "https://yourdomain.com"
```

### 3. 포트 변경

기본 포트를 변경하여 보안 강화:

```powershell
# 서버 시작 시 포트 지정
$env:PORT = "8443"
cd open-webui/backend
python -m uvicorn open_webui.main:app --host 0.0.0.0 --port 8443
```

## 역방향 프록시 설정

### Nginx 설정 (Linux)

#### 1. Nginx 설치

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx

# CentOS/RHEL
sudo yum install nginx
```

#### 2. 설정 파일 생성

`/etc/nginx/sites-available/open-webui`:

```nginx
server {
    listen 80;
    server_name yourdomain.com;  # 도메인 또는 IP 주소

    # 로그 설정
    access_log /var/log/nginx/open-webui-access.log;
    error_log /var/log/nginx/open-webui-error.log;

    # 클라이언트 최대 바디 크기 (파일 업로드용)
    client_max_body_size 100M;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        
        # WebSocket 지원
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # 헤더 설정
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 타임아웃 설정
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
```

#### 3. 심볼릭 링크 생성 및 활성화

```bash
sudo ln -s /etc/nginx/sites-available/open-webui /etc/nginx/sites-enabled/
sudo nginx -t  # 설정 테스트
sudo systemctl restart nginx
```

### Apache 설정 (Linux)

#### 1. Apache 설치

```bash
# Ubuntu/Debian
sudo apt install apache2

# CentOS/RHEL
sudo yum install httpd
```

#### 2. 모듈 활성화

```bash
sudo a2enmod proxy
sudo a2enmod proxy_http
sudo a2enmod proxy_wstunnel
sudo a2enmod headers
```

#### 3. 설정 파일 생성

`/etc/apache2/sites-available/open-webui.conf`:

```apache
<VirtualHost *:80>
    ServerName yourdomain.com
    
    ProxyPreserveHost On
    ProxyRequests Off
    
    # WebSocket 지원
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*) ws://127.0.0.1:8080/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*) http://127.0.0.1:8080/$1 [P,L]
    
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/
    
    # 헤더 설정
    ProxyPassReverse / http://127.0.0.1:8080/
    RequestHeader set X-Forwarded-Proto "http"
    RequestHeader set X-Forwarded-Port "80"
    
    # 로그 설정
    ErrorLog ${APACHE_LOG_DIR}/open-webui-error.log
    CustomLog ${APACHE_LOG_DIR}/open-webui-access.log combined
</VirtualHost>
```

#### 4. 사이트 활성화

```bash
sudo a2ensite open-webui.conf
sudo apache2ctl configtest
sudo systemctl restart apache2
```

### Windows에서 Nginx 사용

#### 1. Nginx 다운로드

https://nginx.org/en/download.html 에서 Windows 버전 다운로드

#### 2. 설정 파일 수정

`nginx.conf`:

```nginx
server {
    listen 80;
    server_name localhost;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

#### 3. 실행

```powershell
# Nginx 디렉토리에서
.\nginx.exe
```

## HTTPS 설정

### Let's Encrypt를 사용한 무료 SSL 인증서

#### 1. Certbot 설치

```bash
# Ubuntu/Debian
sudo apt install certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install certbot python3-certbot-nginx
```

#### 2. 인증서 발급

```bash
sudo certbot --nginx -d yourdomain.com
```

#### 3. 자동 갱신 설정

```bash
sudo certbot renew --dry-run
```

### Nginx HTTPS 설정 예시

```nginx
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;
    
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## 클라우드 배포

### AWS EC2

#### 1. EC2 인스턴스 생성

1. AWS 콘솔 → EC2 → 인스턴스 시작
2. Ubuntu Server 선택
3. 보안 그룹 설정:
   - SSH (22): 내 IP
   - HTTP (80): 0.0.0.0/0
   - HTTPS (443): 0.0.0.0/0
   - Custom TCP (8080): 필요시

#### 2. 서버 설정

```bash
# SSH 접속
ssh -i your-key.pem ubuntu@your-ec2-ip

# 업데이트
sudo apt update && sudo apt upgrade -y

# Python 및 필수 패키지 설치
sudo apt install python3 python3-pip nginx

# Open WebUI 설치 및 실행
# (로컬과 동일한 방법)
```

#### 3. Elastic IP 할당 (선택사항)

고정 IP 주소를 원하는 경우:
1. EC2 → Elastic IPs
2. "Allocate Elastic IP address"
3. 인스턴스에 연결

### Google Cloud Platform

#### 1. VM 인스턴스 생성

1. GCP 콘솔 → Compute Engine → VM 인스턴스
2. Ubuntu 선택
3. 방화벽 규칙:
   - HTTP 트래픽 허용
   - HTTPS 트래픽 허용

#### 2. 외부 IP 설정

1. VM 인스턴스 → 편집
2. 네트워크 인터페이스 → 외부 IP → 예약된 정적 주소

### Azure

#### 1. 가상 머신 생성

1. Azure Portal → Virtual machines
2. Ubuntu Server 선택
3. 네트워크 보안 그룹에서 포트 열기:
   - 80, 443, 8080

### Docker 배포

#### 1. Dockerfile 생성

```dockerfile
FROM python:3.10-slim

WORKDIR /app

# 의존성 설치
COPY open-webui/backend/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 애플리케이션 복사
COPY open-webui/backend/ .

# 포트 노출
EXPOSE 8080

# 실행
CMD ["python", "-m", "uvicorn", "open_webui.main:app", "--host", "0.0.0.0", "--port", "8080"]
```

#### 2. 빌드 및 실행

```bash
docker build -t open-webui .
docker run -d -p 8080:8080 \
  -v $(pwd)/data:/app/data \
  --name open-webui \
  open-webui
```

#### 3. Docker Compose 사용

`docker-compose.yml`:

```yaml
version: '3.8'

services:
  webui:
    build: .
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    environment:
      - WEBUI_AUTH=true
      - ENABLE_SIGNUP=false
    restart: unless-stopped
```

실행:
```bash
docker-compose up -d
```

## 문제 해결

### 1. 외부에서 접속 불가

**확인 사항**:
- [ ] 서버가 실행 중인가?
- [ ] 방화벽이 포트를 허용하는가?
- [ ] 라우터 포트 포워딩이 설정되었는가?
- [ ] 공인 IP 주소가 올바른가?

**해결 방법**:
```bash
# 서버 상태 확인
curl http://localhost:8080

# 포트 확인
netstat -tuln | grep 8080

# 방화벽 확인
sudo ufw status
```

### 2. 연결이 느림

**원인**:
- 네트워크 대역폭 부족
- 서버 리소스 부족
- 프록시 설정 문제

**해결**:
- 서버 리소스 확인
- 프록시 버퍼 크기 조정
- CDN 사용 고려

### 3. WebSocket 연결 실패

**원인**:
- 프록시가 WebSocket을 지원하지 않음

**해결**:
- Nginx/Apache 설정에서 WebSocket 지원 확인
- 헤더 설정 확인

### 4. HTTPS 리다이렉트 루프

**원인**:
- 프록시 헤더 설정 누락

**해결**:
```nginx
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Forwarded-Port $server_port;
```

## 보안 체크리스트

- [ ] HTTPS 사용 (SSL/TLS 인증서)
- [ ] 강력한 관리자 비밀번호 설정
- [ ] 불필요한 포트 닫기
- [ ] 정기적인 보안 업데이트
- [ ] 방화벽 규칙 설정
- [ ] 로그 모니터링
- [ ] 백업 설정
- [ ] 회원가입 제한 (필요시)
- [ ] CORS 설정
- [ ] Rate Limiting 설정

## 성능 최적화

### 1. Nginx 캐싱

```nginx
location /static/ {
    alias /path/to/static/;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 2. Gzip 압축

```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript;
gzip_min_length 1000;
```

### 3. 서버 리소스 모니터링

```bash
# CPU 및 메모리 사용량
top
htop

# 디스크 사용량
df -h

# 네트워크 사용량
iftop
```

## 추가 리소스

- [Open WebUI 공식 문서](https://docs.openwebui.com/)
- [Nginx 문서](https://nginx.org/en/docs/)
- [Let's Encrypt 문서](https://letsencrypt.org/docs/)
- 프로젝트 GitHub: https://github.com/JamesDylanMa/webui

